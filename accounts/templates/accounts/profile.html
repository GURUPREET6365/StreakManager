{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Profile • QuickPrep</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" />

  <link rel="stylesheet" href="{% static 'css/profile.css' %}">
</head>
<body>

  <!-- Minimal brand/nav -->
  <nav class="navbar navbar-dark">
    <div class="container">
      <a href="{% url 'home' %}" class="navbar-brand d-flex align-items-center">
        <i class="bi bi-lightning-charge-fill me-2"></i> QuickPrep
      </a>
      <div class="d-flex gap-2">
        <a href="{% url 'logout' %}" class="btn btn-outline-warning btn-sm">
          <i class="bi bi-box-arrow-right"></i> <span class="ms-1">Logout</span>
        </a>
      </div>
    </div>
  </nav>


  <main class="py-4 py-sm-5">
    <div class="container">
      <div class="row justify-content-center">
        <!-- Mobile-first: full width; then constrain on md/lg -->
        <div class="col-12 col-md-8 col-lg-7 col-xl-6">
          <!-- Profile Card -->
          <div class="card shadow-sm">
            <div class="card-body p-4 p-sm-5">
    {% if messages %}
  {% for message in messages %}
    <div class="alert 
                {% if message.tags == 'error' %}alert-danger
                {% elif message.tags == 'success' %}alert-success
                {% elif message.tags == 'warning' %}alert-warning
                {% elif message.tags == 'info' %}alert-primary
                {% else %}alert-primary
                {% endif %}
                alert-dismissible fade show shadow-sm fw-semibold"
         role="alert">

      {{ message }}

      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}

              <!-- Back / Home -->
              <div class="d-flex justify-content-between align-items-center mb-3">
                <a href="{% url 'home' %}" class="btn btn-outline-primary btn-sm">
                  <i class="bi bi-house-door"></i>
                  <span class="d-none d-sm-inline ms-1">Home</span>
                </a>
                <span class="chip d-none d-sm-inline">Profile</span>
              </div>

              <!-- Profile header -->
              <div class="text-center mb-4">
                <div class="avatar mx-auto mb-3">
                  <i class="bi bi-person fs-1"></i>
                </div>

                <div class="d-flex flex-column align-items-center gap-1">
                  <!-- Name with Edit Button -->
                  <div class="d-flex align-items-center gap-2 flex-wrap justify-content-center">
                    <h5 class="mb-0">
                      {{ user.f_name|default:"User" }} {{ user.l_name }}
                    </h5>
                    <button type="button"
                            class="btn btn-outline-primary btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#editNameModal"
                            aria-label="Edit name"
                            title="Edit name">
                      <i class="bi bi-pencil"></i>
                      <span class="d-none d-sm-inline ms-1">Edit</span>
                    </button>
                  </div>

                  <!-- Username with Edit Button -->
                  <div class="d-flex align-items-center gap-2 text-muted">
                    <span>@{{ user.username }}</span>
                    <button type="button"
                            class="btn btn-outline-primary btn-sm"
                            data-bs-toggle="modal"
                            data-bs-target="#editUsernameModal"
                            aria-label="Edit username"
                            title="Edit username">
                      <i class="bi bi-pencil"></i>
                      <span class="d-none d-sm-inline ms-1">Edit</span>
                    </button>
                  </div>
                </div>
              </div>

              <div class="divider"></div>

              <!-- Account Details -->
              <section aria-labelledby="account-details-title">
                <h6 id="account-details-title" class="section-title mb-3">Account Details</h6>

                <ul class="list-group list-group-flush">

                  <!-- Email -->
                  <li class="list-group-item py-3">
                    <div class="row g-2 align-items-center">
                      <div class="col-12 col-sm-4 d-flex align-items-center gap-2">
                        <i class="bi bi-envelope text-info"></i>
                        <span class="text-secondary">Email</span>
                      </div>
                      <div class="col-12 col-sm-6 text-sm-start">
                        <div class="text-break-word">{{ user.email|default:"Not Provided" }}</div>
                      </div>
                      <div class="col-12 col-sm-2 text-sm-end">
                        <button type="button"
                                class="btn btn-outline-primary btn-sm"
                                data-bs-toggle="modal"
                                data-bs-target="#editEmailModal"
                                aria-label="Edit email"
                                title="Edit email">
                          <i class="bi bi-pencil"></i>
                          <span class="d-none d-lg-inline ms-1">Edit</span>
                        </button>
                      </div>
                    </div>
                  </li>

                  <!-- Member Since -->
                  <li class="list-group-item py-3">
                    <div class="row g-2 align-items-center">
                      <div class="col-12 col-sm-6 d-flex align-items-center gap-2">
                        <i class="bi bi-calendar text-info"></i>
                        <span class="text-secondary">Member Since</span>
                      </div>
                      <div class="col-12 col-sm-6 text-sm-end">
                        <span>{{ user.date_joined|date:"d M Y" }}</span>
                      </div>
                    </div>
                  </li>

                  <!-- Last Login -->
                  <li class="list-group-item py-3">
                    <div class="row g-2 align-items-center">
                      <div class="col-12 col-sm-6 d-flex align-items-center gap-2">
                        <i class="bi bi-clock-history text-info"></i>
                        <span class="text-secondary">Last Login</span>
                      </div>
                      <div class="col-12 col-sm-6 text-sm-end">
                        <span>{{ user.l_login|date:"d M Y, h:i A"|default:"Never" }}</span>
                      </div>
                    </div>
                  </li>
                </ul>
              </section>

              <div class="divider"></div>

              <!-- Actions -->
              <div class="d-grid gap-2 gap-sm-3 d-sm-flex justify-content-sm-between">
    <!-- Reset Password Button -->
                <button type="button"     
                    class="btn btn-outline-secondary w-100 w-sm-auto"
                    data-bs-toggle="modal"
                    data-bs-target="#resetpassword"
                    aria-label="Reset Password"
                    title="Reset Password">
                
                    <i class="bi bi-arrow-clockwise"></i> <!-- Added a Bootstrap icon class for clarity -->
                    <span class="ms-1">Reset Password</span>
                </button>
                <button type="button"
                      class="btn btn-outline-danger w-100 w-sm-auto"
                      data-bs-toggle="modal"
                      data-bs-target="#deleteaccount"
                      aria-label="Delete Account"
                      title="Delete Account">
                <i class="bi bi-trash"></i>
                <span class="ms-1">Delete Account</span>
              </button>
                
              </div>

            </div>
          </div>
          <!-- /Profile Card -->
        </div>
      </div>
    </div>
  </main>

  <!-- Edit Name Modal -->
  <div class="modal fade" id="editNameModal" tabindex="-1" aria-labelledby="editNameLabel" >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editNameLabel">Edit Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="{% url 'changefnamelname' %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="first_name" class="form-label">First Name</label>
             {{form2.first_name}}
            </div>
            <div class="mb-3">
              <label for="last_name" class="form-label">Last Name</label>
              {{form2.last_name}}
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-sm">
              <i class="bi bi-check2"></i> Save
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Username Modal -->
  <div class="modal fade" id="editUsernameModal" tabindex="-1" aria-labelledby="editUsernameLabel" >
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editUsernameLabel">Edit Username</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <form method="POST" action="{% url 'changeusername' %}">
          {% csrf_token %}
          <div class="modal-body">
            <div class="mb-3">
              <label for="username" class="form-label">Username</label>
              {{form1.username}}
              <div class="form-text" style="color: #94a3b8;">Username must be unique.</div>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
            <button type="submit" class="btn btn-primary btn-sm">
              <i class="bi bi-check2"></i> Save
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Edit Email Modal -->
<!-- Modal 1: Edit Email -->
<div class="modal fade" id="editEmailModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Edit Email</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form method="POST" action="{% url 'changeemail' %}" id="changeEmailForm">
        {% csrf_token %}
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Email Address</label>
            {{ form3.email }}
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary btn-sm">Send OTP</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  document.getElementById('changeEmailForm').addEventListener('submit', function(e) {
    // Form will submit normally and Django will redirect
    // The page will reload with the new view
  });
</script>


  <!-- Change Password -->
    <div class="modal fade" id="resetpassword" tabindex="-1"  >
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title" id="resetpasswordLabel">Reset Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
<form method="POST" action="{% url 'changepassword' %}">
        {% csrf_token %}
        
        <div class="modal-body">

          <!-- Old Password -->
          <label class="form-label" for="oldpassword">Old Password</label>
          <div class="input-group mb-3">
            {{ form.old_password }}
            <button class="btn btn-outline-secondary" type="button" id="toggleOld">
              <i class="bi bi-eye-slash" id="iconOld"></i>
            </button>
          </div>

          <!-- New Password -->
          <label class="form-label">New Password</label>
          <div class="input-group mb-3">
            {{ form.new_password1 }}
            <button class="btn btn-outline-secondary" type="button" id="toggleNew1">
              <i class="bi bi-eye-slash" id="iconNew1"></i>
            </button>
          </div>

          <!-- Confirm New Password -->
          <label class="form-label">Confirm New Password</label>
          <div class="input-group mb-3">
            {{ form.new_password2 }}
            <button class="btn btn-outline-secondary" type="button" id="toggleNew2">
              <i class="bi bi-eye-slash" id="iconNew2"></i>
            </button>
          </div>

        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary btn-sm">
            <i class="bi bi-check2"></i> Save
          </button>
        </div>
      </form>

    </div>
  </div>
</div>

<!-- Delete Account -->
  <!-- Delete Account Modal -->
<div class="modal fade" id="deleteaccount" tabindex="-1" aria-labelledby="deleteaccountLabel" >
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content" style="background: #1e293b; border: 1px solid rgba(56, 189, 248, 0.2);">
      <div class="modal-header" style="border-bottom-color: rgba(56, 189, 248, 0.12);">
        <h5 class="modal-title" id="deleteaccountLabel" style="color: #ef4444;">Delete Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: brightness(1.5);"></button>
      </div>
      <form method="POST" action="{% url 'delete_account' %}">
        {% csrf_token %}
        <div class="modal-body">
          <div class="alert alert-warning small" style="background: rgba(239, 193, 35, 0.1); border: 1px solid rgba(239, 193, 35, 0.3); color: #fcd34d;">
            <div class="fw-semibold mb-1">⚠️ What will happen:</div>
            <ul class="mb-0" style="color: #fcd34d;">
              <li>Your account and profile will be removed.</li>
              <li>Your streaks and related data will be deleted permanently.</li>
              <li>This action cannot be undone.</li>
            </ul>
          </div>
        </div>
        <div class="modal-footer" style="border-top-color: rgba(56, 189, 248, 0.12);">
          <button type="button" class="btn btn-secondary btn-sm" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-danger btn-sm">
            <i class="bi bi-trash"></i> Delete Account
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


  <!-- Footer -->
  <footer class="py-3 mt-auto">
    <div class="container text-center small">
      <p class="mb-2">&copy; 2025 QuickPrep. Built with <i class="bi bi-heart-fill" style="color: #ef4444;"></i> in Bharat.</p>
      <p class="mb-0">
        <a href="{% url 'about_us' %}#about-tab">About</a> • 
                <a href="{% url 'about_us' %}#privacy-tab">Privacy</a> • 
                <a href="{% url 'about_us' %}#terms-tab">Terms</a>
      </p>
    </div>
  </footer>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="{% static 'js/profile.js' %}"></script>
</body>
</html>
